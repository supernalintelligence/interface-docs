/**
 * ⚠️  AUTO-GENERATED FILE - DO NOT EDIT
 * 
 * This file is automatically generated from Gherkin feature files.
 * To make changes:
 *   1. Edit the .feature file in features/
 *   2. Run: npm run story:generate
 * 
 * Generated Playwright Test
 * Feature: Chat Component
 * 
 * Generated by: GraphTestGenerator
 */

import { test, expect } from '@playwright/test';
import { testId } from '@supernal/interface/testing';
import { Chat, Examples } from '../../../src/architecture/DemoComponentNames';
import { Routes } from '../../../src/architecture/Routes';
import { setComponentState, getComponentState, initializeTestState } from '@supernal/interface/testing';
import { ComponentData } from '../../../src/architecture/DemoComponentData';

test.describe('Chat Component', () => {
  test.setTimeout(30000);

  // Initialize test state manager after page navigation
  test.afterEach(async ({ page }) => {
    // Clean up test state after each test
  });

  test('Starting with empty chat', async ({ page }) => {
    // Execution order: Starting with empty chat-59 → Starting with empty chat-60 → Starting with empty chat-61 → Starting with empty chat-62 → Starting with empty chat-63 → Starting with empty chat-64
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.empty
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.empty);

    // Then Components.Chat.messages should be empty
    // Verify no user/ai chat messages exist (system messages may be present)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(0);

    // And Components.Chat.input should be enabled
    await expect(page.locator(testId(Chat.input))).toBeEnabled();

  });

  test('Sending a single message', async ({ page }) => {
    // Execution order: Sending a single message-65 → Sending a single message-66 → Sending a single message-67 → Sending a single message-68 → Sending a single message-69 → Sending a single message-70 → Sending a single message-71 → Sending a single message-72
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.empty
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.empty);

    // When I type "Hello, World!" in Components.Chat.input
    await page.locator(testId(Chat.input)).fill('Hello, World!');

    // And I click Components.Chat.sendButton
    await page.locator(testId(Chat.sendButton)).first().click();

    // Then Components.Chat.messages should contain 1 message
    // Verify Components.Chat.messages contains 1 user/ai chat message(s)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(1);

    // And Components.Chat.messages last message should be "Hello, World!"
    // Verify last user message contains expected text
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"]').last()).toContainText('Hello, World!');

  });

  test('Viewing existing conversation', async ({ page }) => {
    // Execution order: Viewing existing conversation-73 → Viewing existing conversation-74 → Viewing existing conversation-75 → Viewing existing conversation-76 → Viewing existing conversation-77
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.withMessages
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.withMessages);

    // Then Components.Chat.messages should contain 2 messages
    // Verify Components.Chat.messages contains 2 user/ai chat message(s)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(2);

  });

  test('Adding to existing conversation', async ({ page }) => {
    // Execution order: Adding to existing conversation-78 → Adding to existing conversation-79 → Adding to existing conversation-80 → Adding to existing conversation-81 → Adding to existing conversation-82 → Adding to existing conversation-83 → Adding to existing conversation-84
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.single
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.single);

    // When I type "How are you?" in Components.Chat.input
    await page.locator(testId(Chat.input)).fill('How are you?');

    // And I click Components.Chat.sendButton
    await page.locator(testId(Chat.sendButton)).first().click();

    // Then Components.Chat.messages should contain 2 messages
    // Verify Components.Chat.messages contains 2 user/ai chat message(s)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(2);

  });

  test('Clearing all messages', async ({ page }) => {
    // Execution order: Clearing all messages-85 → Clearing all messages-86 → Clearing all messages-87 → Clearing all messages-88 → Clearing all messages-89 → Clearing all messages-90 → Clearing all messages-91
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.withMessages
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.withMessages);

    // When I click Components.Chat.clearButton
    await page.locator(testId(Chat.clearButton)).first().click();

    // Then chat state should be Components.Examples.chat.state.empty
    // State assertion: Examples.chat.state.empty
    // const state = await getComponentState(page, 'component');
    // expect(state).toEqual(Examples.chat.state.empty);

    // And Components.Chat.messages should be empty
    // Verify no user/ai chat messages exist (system messages may be present)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(0);

  });

  test('Multiple messages in sequence', async ({ page }) => {
    // Execution order: Multiple messages in sequence-92 → Multiple messages in sequence-93 → Multiple messages in sequence-94 → Multiple messages in sequence-95 → Multiple messages in sequence-96 → Multiple messages in sequence-97 → Multiple messages in sequence-98 → Multiple messages in sequence-99 → Multiple messages in sequence-100 → Multiple messages in sequence-101 → Multiple messages in sequence-102
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.empty
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.empty);

    // When I type "Hello" in Components.Chat.input
    await page.locator(testId(Chat.input)).fill('Hello');

    // And I click Components.Chat.sendButton
    await page.locator(testId(Chat.sendButton)).first().click();

    // And I type "How are you?" in Components.Chat.input
    await page.locator(testId(Chat.input)).fill('How are you?');

    // And I click Components.Chat.sendButton
    await page.locator(testId(Chat.sendButton)).first().click();

    // And I type "Nice to meet you" in Components.Chat.input
    await page.locator(testId(Chat.input)).fill('Nice to meet you');

    // And I click Components.Chat.sendButton
    await page.locator(testId(Chat.sendButton)).first().click();

    // Then Components.Chat.messages should contain 3 messages
    // Verify Components.Chat.messages contains 3 user/ai chat message(s)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(3);

  });

  test('Message persistence across actions', async ({ page }) => {
    // Execution order: Message persistence across actions-103 → Message persistence across actions-104 → Message persistence across actions-105 → Message persistence across actions-106 → Message persistence across actions-107 → Message persistence across actions-108 → Message persistence across actions-109
    // Given I am on Routes.Demo
    await page.goto(`${Routes.Demo}`);
    await initializeTestState(page);

    // Given Components.Chat.bubble is visible
    await page.locator(testId(Chat.bubble)).first().waitFor({ state: 'visible' });

    // When I click Components.Chat.bubble
    await page.locator(testId(Chat.bubble)).first().click();

    // Given chat state is Components.Examples.chat.state.single
    await setComponentState(page, 'chat', ComponentData.Examples.chat.state.single);

    // When I refresh the page
    await page.reload();
    await initializeTestState(page);

    // Then chat state should be Components.Examples.chat.state.single
    // State assertion: Examples.chat.state.single
    // const state = await getComponentState(page, 'component');
    // expect(state).toEqual(Examples.chat.state.single);

    // And Components.Chat.messages should contain 1 message
    // Verify Components.Chat.messages contains 1 user/ai chat message(s)
    await expect(page.locator(testId(Chat.messages)).locator('[data-testid="chat-message-user"], [data-testid="chat-message-ai"]')).toHaveCount(1);

  });

});
